{{ template "base" .}}

<!-- Halaman buat order -->
{{ define "dashboard_orders_add_content" }}
<h2
  class="px-6 sm:px-0 my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200"
>
  Buat Order
</h2>

<div class="grid gap-6 mb-8">
  <!-- Produk baru -->
  <div class="p-4 bg-white sm:rounded-lg shadow-xs dark:bg-gray-800">
    <div x-data="create()" x-init="init($dispatch)" id="create">
      <div x-show="!orderCreated">
        <div class="flex flex-wrap mb-6">
          <!-- Konsumen -->
          <div class="w-full relative md:w-2/3 md:px-1">
            <label class="block text-sm">
              <span class="text-gray-700 dark:text-gray-400">Konsumen</span>
              <input
                class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-gray-100 focus:outline-none focus:shadow-md dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                placeholder="Nomor Induk Kependudukan (NIK)"
                x-model="instantData.customer"
                @keyup="if (instantData.customer.length > 5 && instantData.customer.length <= 16) { closeCustomerIS = false; searchNIK(); } else { closeCustomerIS = true; }"
                @click="if (instantData.customer.length > 5 && instantData.customer.length <= 16) { closeCustomerIS = false; } else { closeCustomerIS = true; }"
                @click.away="closeCustomerIS = true;"
                @keydown.tab="closeCustomerIS = true;"
                x-show="$parent.isObjEmpty(tempDataCustomer)"
                :class="{'border-red-600 focus:border-red-400 focus:outline-none focus:shadow-outline-red': errCustomer }"
              />
              <div class="w-full">
                <div
                  class="relative bg-blue-400 bg-opacity-50 mt-1 text-sm inline-block py-1 pl-4 pr-8 rounded-full"
                  x-show="!$parent.isObjEmpty(tempDataCustomer)"
                >
                  <i
                    x-text="tempDataCustomer.Firstname +' '+ tempDataCustomer.Lastname"
                  ></i>
                  (<b x-text="tempDataCustomer.RIC"></b>)
                  <p
                    style="margin-top: 0.42rem"
                    class="cursor-pointer absolute right-0 top-0 mr-2"
                    @click="tempDataCustomer = {};
                    addresses = [];
                    formData.customer = 0;
                    tempDataBillingAddress = {};
                    formData.billing_address = 0;
                    tempDataShippingAddress = {};
                    formData.shipping_address = 0;"
                  >
                    {{ template "_svg_icon_close" }}
                  </p>
                </div>
              </div>
            </label>
            <span
              class="text-xs text-red-600 dark:text-red-400"
              x-text="errmCustomer"
              :class="{'invisible': errCustomer == false}"
            >
            </span>
            <ul
              x-transition:leave="transition ease-in duration-150"
              x-transition:leave-start="opacity-100"
              x-transition:leave-end="opacity-0"
              x-show="!closeCustomerIS"
              class="absolute z-30 left-0 right-0 md:mr-1 md:ml-1 text-gray-600 bg-white border-none border-r border-l border-b border-gray-100 rounded-br-md rounded-bl-md shadow-md dark:border-gray-700 dark:text-gray-300 dark:bg-gray-700"
              :class="{'-mt-1': !errCustomer, '-mt-6': errCustomer }"
              aria-label="submenu"
            >
              <div
                x-show="customerIS.length > 0 && closeCustomerIS == false && $parent.isObjEmpty(tempDataCustomer)"
              >
                <template x-for="(customer, index) in customerIS" :key="index">
                  <li class="flex">
                    <a
                      class="inline-flex items-center w-full px-3 py-1 text-sm transition-colors duration-150 hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                      href="#"
                      tabindex="-1"
                      @click="tempDataCustomer = 
                      {
                        ID: customer.ID,
                        Firstname: customer.Firstname,
                        Lastname: customer.Lastname,
                        RIC: customer.RIC,
                      };
                      if (customer.Addresses) {
                        addresses = customer.Addresses;
                      }
                      formData.customer = customer.ID;"
                    >
                      <img
                        class="object-cover w-5 h-5 rounded-full mr-3"
                        :src="'/file/profile/thumbnail/'+customer.Avatar"
                        alt=""
                        loading="lazy"
                      />
                      <span
                        x-text="customer.Firstname +' '+ customer.Lastname"
                      ></span>
                    </a>
                  </li>
                </template>
              </div>
              <div x-show="customerIS.length == 0">
                <span
                  class="inline-flex items-center w-full px-3 py-1 text-sm transition-colors duration-150 hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                  >Tidak ada data</span
                >
              </div>
            </ul>
          </div>

          <div class="w-full block mt-5 md:w-1/3 md:px-1">
            <button
              class="inline-block p-3 text-center text-white transition rounded-full shadow hover:shadow-lg focus:outline-none"
              @click="$dispatch('modal', { html: $refs.selectProduct.innerHTML });"
              :class="{'bg-red-500 hover:bg-red-400': errOrderItems, 'bg-green-500 hover:bg-green-400': !errOrderItems }"
              :title="errmOrderItems"
            >
              <svg
                class="w-5 h-5 text-white"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
                />
              </svg>
            </button>
          </div>

          <!-- Pilih Produk -->
          {{ template "dashboard_orders_add_select_product_modal" .}}

          <!-- Pendamping -->
          {{ template "dashboard_orders_add_substitute_modal" .}}

          <div class="w-full md:w-2/3">
            <div class="w-full flex flex-wrap">
              <!-- Sales -->
              <div class="w-full relative md:w-1/2 md:px-1">
                <label class="block mt-4 text-sm">
                  <span class="text-gray-700 dark:text-gray-400">Sales</span>
                  <input
                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-gray-100 focus:outline-none focus:shadow-md dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                    placeholder="Nama Sales"
                    x-model="instantData.sales"
                    @keyup="if (instantData.sales.length >= 3 && instantData.sales.length <= 25) { closeSalesIS = false; searchSales(); } else { closeSalesIS = true; }"
                    @click="if (instantData.sales.length >= 3 && instantData.sales.length <= 25) { closeSalesIS = false; } else { closeSalesIS = true; }"
                    @click.away="closeSalesIS = true;"
                    @keydown.tab="closeSalesIS = true;"
                    x-show="$parent.isObjEmpty(tempDataSales)"
                    :class="{'border-red-600 focus:border-red-400 focus:outline-none focus:shadow-outline-red': errSales }"
                  />
                </label>
                <div class="w-full">
                  <div
                    class="relative bg-blue-400 bg-opacity-50 mt-1 text-sm inline-block py-1 pl-4 pr-8 rounded-full"
                    x-show="!$parent.isObjEmpty(tempDataSales)"
                  >
                    <i
                      x-text="tempDataSales.Firstname +' '+ tempDataSales.Lastname"
                    ></i>
                    (<b x-text="tempDataSales.Username"></b>)
                    <p
                      style="margin-top: 0.42rem"
                      class="cursor-pointer absolute right-0 top-0 mr-2"
                      @click="tempDataSales = {};
                  formData.sales = 0;"
                    >
                      {{ template "_svg_icon_close" }}
                    </p>
                  </div>
                </div>
                <ul
                  x-transition:leave="transition ease-in duration-150"
                  x-transition:leave-start="opacity-100"
                  x-transition:leave-end="opacity-0"
                  x-show="!closeSalesIS"
                  class="absolute z-30 left-0 right-0 -mt-1 md:mr-1 md:ml-1 text-gray-600 bg-white border-none border-r border-l border-b border-gray-100 rounded-br-md rounded-bl-md shadow-md dark:border-gray-700 dark:text-gray-300 dark:bg-gray-700"
                  aria-label="submenu"
                >
                  <div
                    x-show="salesIS.length > 0 && closeSalesIS == false && $parent.isObjEmpty(tempDataSales)"
                  >
                    <template x-for="(sales, index) in salesIS" :key="index">
                      <li class="flex">
                        <a
                          class="inline-flex items-center w-full px-3 py-1 text-sm transition-colors duration-150 hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                          href="#"
                          tabindex="-1"
                          @click="tempDataSales = 
                      {
                        ID: sales.ID,
                        Firstname: sales.Firstname,
                        Lastname: sales.Lastname,
                        Username: sales.Username,
                      };
                      formData.sales = sales.ID;"
                        >
                          <img
                            class="object-cover w-5 h-5 rounded-full mr-3"
                            :src="'/file/profile/thumbnail/'+sales.Avatar"
                            alt=""
                            loading="lazy"
                          />
                          <span
                            x-text="sales.Firstname +' '+ sales.Lastname"
                          ></span>
                        </a>
                      </li>
                    </template>
                  </div>
                  <div x-show="salesIS.length == 0">
                    <span
                      class="inline-flex items-center w-full px-3 py-1 text-sm transition-colors duration-150 hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                      >Tidak ada data</span
                    >
                  </div>
                </ul>
              </div>

              <!-- Surveyor -->
              <div class="w-full relative md:w-1/2 md:px-1">
                <label class="block mt-4 text-sm">
                  <span class="text-gray-700 dark:text-gray-400">Surveyor</span>
                  <input
                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-gray-100 focus:outline-none focus:shadow-md dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                    placeholder="Nama Surveyor"
                    x-model="instantData.surveyor"
                    @keyup="if (instantData.surveyor.length >= 3 && instantData.surveyor.length <= 25) { closeSurveyorIS = false; searchSurveyor(); } else { closeSurveyorIS = true; }"
                    @click="if (instantData.surveyor.length >= 3 && instantData.surveyor.length <= 25) { closeSurveyorIS = false; } else { closeSurveyorIS = true; }"
                    @click.away="closeSurveyorIS = true;"
                    @keydown.tab="closeSurveyorIS = true;"
                    x-show="$parent.isObjEmpty(tempDataSurveyor)"
                    :class="{'border-red-600 focus:border-red-400 focus:outline-none focus:shadow-outline-red': errSurveyor }"
                  />
                </label>
                <div class="w-full">
                  <div
                    class="relative bg-blue-400 bg-opacity-50 mt-1 text-sm inline-block py-1 pl-4 pr-8 rounded-full"
                    x-show="!$parent.isObjEmpty(tempDataSurveyor)"
                  >
                    <i
                      x-text="tempDataSurveyor.Firstname +' '+ tempDataSurveyor.Lastname"
                    ></i>
                    (<b x-text="tempDataSurveyor.Username"></b>)
                    <p
                      style="margin-top: 0.42rem"
                      class="cursor-pointer absolute right-0 top-0 mr-2"
                      @click="tempDataSurveyor = {};
                  formData.surveyor = 0;"
                    >
                      {{ template "_svg_icon_close" }}
                    </p>
                  </div>
                </div>
                <ul
                  x-transition:leave="transition ease-in duration-150"
                  x-transition:leave-start="opacity-100"
                  x-transition:leave-end="opacity-0"
                  x-show="!closeSurveyorIS"
                  class="absolute z-30 left-0 right-0 -mt-1 md:mr-1 md:ml-1 text-gray-600 bg-white border-none border-r border-l border-b border-gray-100 rounded-br-md rounded-bl-md shadow-md dark:border-gray-700 dark:text-gray-300 dark:bg-gray-700"
                  aria-label="submenu"
                >
                  <div
                    x-show="surveyorIS.length > 0 && closeSurveyorIS == false && $parent.isObjEmpty(tempDataSurveyor)"
                  >
                    <template
                      x-for="(surveyor, index) in surveyorIS"
                      :key="index"
                    >
                      <li class="flex">
                        <a
                          class="inline-flex items-center w-full px-3 py-1 text-sm transition-colors duration-150 hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                          href="#"
                          tabindex="-1"
                          @click="tempDataSurveyor = 
                      {
                        ID: surveyor.ID,
                        Firstname: surveyor.Firstname,
                        Lastname: surveyor.Lastname,
                        Username: surveyor.Username,
                      };
                      formData.surveyor = surveyor.ID;"
                        >
                          <img
                            class="object-cover w-5 h-5 rounded-full mr-3"
                            :src="'/file/profile/thumbnail/'+surveyor.Avatar"
                            alt=""
                            loading="lazy"
                          />
                          <span
                            x-text="surveyor.Firstname +' '+ surveyor.Lastname"
                          ></span>
                        </a>
                      </li>
                    </template>
                  </div>
                  <div x-show="surveyorIS.length == 0">
                    <span
                      class="inline-flex items-center w-full px-3 py-1 text-sm transition-colors duration-150 hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                      >Tidak ada data</span
                    >
                  </div>
                </ul>
              </div>

              <!-- Kolektor -->
              <!--
              <div class="w-full relative md:w-1/3 md:px-1">
                <label class="block mt-4 text-sm">
                  <span class="text-gray-700 dark:text-gray-400">Kolektor</span>
                  <input
                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-gray-100 focus:outline-none focus:shadow-md dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                    placeholder="Nama Kolektor"
                    x-model="instantData.collector"
                    @keyup="if (instantData.collector.length >= 3 && instantData.collector.length <= 25) { closeCollectorIS = false; searchCollector(); } else { closeCollectorIS = true; }"
                    @click="if (instantData.collector.length >= 3 && instantData.collector.length <= 25) { closeCollectorIS = false; } else { closeCollectorIS = true; }"
                    @click.away="closeCollectorIS = true;"
                    @keydown.tab="closeCollectorIS = true;"
                    x-show="$parent.isObjEmpty(tempDataCollector)"
                    :class="{'border-red-600 focus:border-red-400 focus:outline-none focus:shadow-outline-red': errCollector }"
                  />
                </label>
                <div class="w-full">
                  <div
                    class="relative bg-blue-400 bg-opacity-50 mt-1 text-sm inline-block py-1 pl-4 pr-8 rounded-full"
                    x-show="!$parent.isObjEmpty(tempDataCollector)"
                  >
                    <i
                      x-text="tempDataCollector.Firstname +' '+ tempDataCollector.Lastname"
                    ></i>
                    (<b x-text="tempDataCollector.Username"></b>)
                    <p
                      style="margin-top: 0.42rem"
                      class="cursor-pointer absolute right-0 top-0 mr-2"
                      @click="tempDataCollector = {};
                  formData.collector = 0;"
                    >
                      {{ template "_svg_icon_close" }}
                    </p>
                  </div>
                </div>
                <ul
                  x-transition:leave="transition ease-in duration-150"
                  x-transition:leave-start="opacity-100"
                  x-transition:leave-end="opacity-0"
                  x-show="!closeCollectorIS"
                  class="absolute z-30 left-0 right-0 -mt-1 md:mr-1 md:ml-1 text-gray-600 bg-white border-none border-r border-l border-b border-gray-100 rounded-br-md rounded-bl-md shadow-md dark:border-gray-700 dark:text-gray-300 dark:bg-gray-700"
                  aria-label="submenu"
                >
                  <div
                    x-show="collectorIS.length > 0 && closeCollectorIS == false && $parent.isObjEmpty(tempDataCollector)"
                  >
                    <template
                      x-for="(collector, index) in collectorIS"
                      :key="index"
                    >
                      <li class="flex">
                        <a
                          class="inline-flex items-center w-full px-3 py-1 text-sm transition-colors duration-150 hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                          href="#"
                          tabindex="-1"
                          @click="tempDataCollector = 
                      {
                        ID: collector.ID,
                        Firstname: collector.Firstname,
                        Lastname: collector.Lastname,
                        Username: collector.Username,
                      };
                      formData.collector = collector.ID;"
                        >
                          <img
                            class="object-cover w-5 h-5 rounded-full mr-3"
                            :src="'/file/profile/thumbnail/'+collector.Avatar"
                            alt=""
                            loading="lazy"
                          />
                          <span
                            x-text="collector.Firstname +' '+ collector.Lastname"
                          ></span>
                        </a>
                      </li>
                    </template>
                  </div>
                  <div x-show="collectorIS.length == 0">
                    <span
                      class="inline-flex items-center w-full px-3 py-1 text-sm transition-colors duration-150 hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                      >Tidak ada data</span
                    >
                  </div>
                </ul>
              </div>
              -->
              <!-- Pembayaran kredit -->
              <div class="w-full md:w-1/2 md:px-1">
                <label class="block mt-4 text-sm">
                  <span class="text-gray-700 dark:text-gray-400"
                    >Metode Pembayaran</span
                  >
                </label>
                <div class="block text-xs">
                  <label class="mt-1">
                    <span class="pr-3 text-green-500 dark:text-green-400"
                      >Cash</span
                    >
                    <div
                      class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"
                    >
                      <input
                        type="checkbox"
                        x-model="formData.credit"
                        class="toggle-checkbox border-green-400 absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"
                      />
                      <span
                        class="toggle-label block overflow-hidden h-6 rounded-full bg-green-400 cursor-pointer"
                      ></span>
                    </div>
                    <span class="pr-3 text-orange-500 dark:text-orange-400"
                      >Kredit</span
                    >
                  </label>
                </div>
              </div>

              <div
                class="w-full md:w-1/2 md:px-1"
                x-show="formData.credit == true"
              >
                <label class="block mt-4 text-sm">
                  <span class="text-gray-700 dark:text-gray-400"
                    >Jatuh tempo</span
                  >
                  <select
                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-gray-100 focus:outline-none focus:shadow-md dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                    x-model.number="formData.due"
                    :class="{'border-red-600 focus:border-red-400 focus:outline-none focus:shadow-outline-red': errDue }"
                  >
                    <option value="0">Setiap...</option>
                    <template x-for="val in 28" :key="val">
                      <option :value="val" x-text="`tanggal ${val}`"></option>
                    </template>
                  </select>
                </label>
                <span
                  class="text-xs text-red-600 dark:text-red-400"
                  x-text="errmDue"
                  :class="{'invisible': errDue == false}"
                >
                </span>
              </div>
            </div>

            <div class="w-full flex flex-wrap" x-show="formData.credit == true">
              <div class="w-full md:w-1/2 md:px-1">
                <label class="block mt-4 text-sm">
                  <span class="text-gray-700 dark:text-gray-400"
                    >Lama Angsuran</span
                  >
                  <select
                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-gray-100 focus:outline-none focus:shadow-md dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                    x-model.number="formData.duration"
                    :class="{'border-red-600 focus:border-red-400 focus:outline-none focus:shadow-outline-red': errDuration }"
                  >
                    <template x-for="(val, index) in 19" :key="index">
                      <option :value="val+1" x-text="val+1 + ' bulan'"></option>
                    </template>
                  </select>
                </label>
                <span
                  class="text-xs text-red-600 dark:text-red-400"
                  x-text="errmDuration"
                  :class="{'invisible': errDuration == false}"
                >
                </span>
              </div>

              <!-- Deposit -->
              <div class="w-full md:w-1/2 md:px-1">
                <label class="block mt-4 text-sm">
                  <span class="text-gray-700 dark:text-gray-400"
                    >Uang DP (deposit)</span
                  >
                  <input
                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-gray-100 focus:outline-none focus:shadow-md dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                    x-model="formData.deposit"
                    :class="{'border-red-600 focus:border-red-400 focus:outline-none focus:shadow-outline-red': errDeposit }"
                  />
                </label>
                <span
                  class="text-xs text-red-600 dark:text-red-400"
                  x-text="errmDeposit"
                  :class="{'invisible': errDeposit == false}"
                >
                </span>
              </div>
            </div>

            <!-- Catatan -->
            <div class="w-full md:px-1">
              <label class="block mt-4 text-sm">
                <span class="text-gray-700 dark:text-gray-400">Catatan</span>
                <textarea
                  class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-gray-100 focus:outline-none focus:shadow-md dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                  rows="3"
                  placeholder="Catatan mengenai order!"
                  x-model="formData.notes"
                ></textarea>
              </label>
            </div>

            <div class="w-full flex flex-wrap">
              <div class="w-full md:w-1/2 md:px-1">
                <label class="block mt-4 text-sm">
                  <span class="text-gray-700 dark:text-gray-400"
                    >Tanggal Pemesanan</span
                  >
                  <input
                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-gray-100 focus:outline-none focus:shadow-md dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                    type="date"
                    x-model="formData.order_date"
                    :class="{'border-red-600 focus:border-red-400 focus:outline-none focus:shadow-outline-red': errOrderDate }"
                    :max="new Date().toISOString().split('T')[0];"
                  />
                </label>
                <span
                  class="text-xs text-red-600 dark:text-red-400"
                  x-text="errmOrderDate"
                  :class="{'invisible': errOrderDate == false}"
                >
                </span>
              </div>

              <div class="w-full md:w-1/2 md:px-1">
                <label class="block mt-4 text-sm">
                  <span class="text-gray-700 dark:text-gray-400"
                    >Tanggal Pengiriman (*opsional)</span
                  >
                  <input
                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-gray-100 focus:outline-none focus:shadow-md dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                    type="date"
                    x-model="formData.shipping_date"
                    :class="{'border-red-600 focus:border-red-400 focus:outline-none focus:shadow-outline-red': errShippingDate }"
                  />
                </label>
                <span
                  class="text-xs text-red-600 dark:text-red-400"
                  x-text="errmShippingDate"
                  :class="{'invisible': errShippingDate == false}"
                >
                </span>
              </div>
            </div>

            <div class="w-full flex flex-wrap">
              <!-- Alamat Pengiriman -->
              <div class="w-full relative md:w-1/2 md:px-1">
                <label class="block mt-4 text-sm">
                  <span class="text-gray-700 dark:text-gray-400"
                    >Alamat Pengiriman</span
                  >
                  <input
                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-gray-100 focus:outline-none focus:shadow-md dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                    placeholder="Alamat Tujuan Pengiriman Barang"
                    @click="if (!$parent.isObjEmpty(tempDataCustomer)) { closeShippingAddressIS = false; } else { closeShippingAddressIS = true; }"
                    @click.away="closeShippingAddressIS = true;"
                    @keydown.tab="closeShippingAddressIS = true;"
                    x-show="$parent.isObjEmpty(tempDataShippingAddress)"
                    :class="{'border-red-600 focus:border-red-400 focus:outline-none focus:shadow-outline-red': errShippingAddress }"
                  />
                </label>
                <div class="w-full">
                  <div
                    class="relative bg-green-300 bg-opacity-50 mt-1 text-sm inline-block py-1 pl-4 pr-8"
                    x-show="!$parent.isObjEmpty(tempDataShippingAddress)"
                  >
                    <i x-text="tempDataShippingAddress.One+', '"></i>
                    <i
                      x-show="tempDataShippingAddress.Two != ''"
                      x-text="tempDataShippingAddress.Two+', '"
                    ></i>
                    <i
                      x-text="tempDataShippingAddress.Village+', '+tempDataShippingAddress.District+', '+tempDataShippingAddress.City+', '+tempDataShippingAddress.Province"
                    ></i>
                    <i
                      x-show="tempDataShippingAddress.Zip != ''"
                      x-text="', '+tempDataShippingAddress.Zip"
                    ></i>
                    <p
                      style="margin-top: 0.42rem"
                      class="cursor-pointer absolute right-0 top-0 mr-2"
                      @click="tempDataShippingAddress = {};
                    formData.shipping_address = 0;"
                    >
                      {{ template "_svg_icon_close" }}
                    </p>
                  </div>
                </div>
                <span
                  class="text-xs text-red-600 dark:text-red-400"
                  x-text="errmShippingAddress"
                  :class="{'invisible': errShippingAddress == false}"
                ></span>
                <ul
                  x-transition:leave="transition ease-in duration-150"
                  x-transition:leave-start="opacity-100"
                  x-transition:leave-end="opacity-0"
                  x-show="!closeShippingAddressIS"
                  class="absolute z-30 left-0 right-0 md:mr-1 md:ml-1 text-gray-600 bg-white border-none border-r border-l border-b border-gray-100 rounded-br-md rounded-bl-md shadow-md dark:border-gray-700 dark:text-gray-300 dark:bg-gray-700"
                  :class="{'-mt-1': !errShippingAddress, '-mt-6': errShippingAddress }"
                  aria-label="submenu"
                >
                  <div
                    x-show="addresses.length > 0 && closeShippingAddressIS == false && $parent.isObjEmpty(tempDataShippingAddress)"
                  >
                    <template
                      x-for="(address, index) in addresses"
                      :key="index"
                    >
                      <li class="flex">
                        <a
                          class="inline-flex items-center w-full px-3 py-1 text-sm transition-colors duration-150 hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                          href="#"
                          tabindex="-1"
                          @click="tempDataShippingAddress = 
                        {
                          ID: address.ID,
                          One: address.One,
                          Two: address.Two,
                          Zip: address.Zip,
                          Village: address.VillageName,
                          District: address.DistrictName,
                          City: address.CityName,
                          Province: address.ProvinceName,
                        };
                        formData.shipping_address = address.ID;"
                        >
                          <!-- TODO img -->
                          <span x-text="address.Name"></span>
                          &nbsp;<i
                            x-text="'( '+address.Description+' )'"
                            class="text-xs text-gray-500"
                            x-show="address.Description != ''"
                          ></i>
                        </a>
                      </li>
                    </template>
                  </div>
                  <div x-show="addresses.length == 0">
                    <span
                      class="inline-flex items-center w-full px-3 py-1 text-sm transition-colors duration-150 hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                      >Tidak ada data</span
                    >
                  </div>
                </ul>
              </div>

              <!-- Alamat Penagihan -->
              <div class="w-full relative md:w-1/2 md:px-1">
                <label
                  class="block mt-4 text-sm"
                  title="Jika alamat penagihan tidak ditetapkan maka alamat penagihan sama dengan alamat pengiriman"
                >
                  <span class="text-gray-700 dark:text-gray-400"
                    >Alamat Penagihan (*opsional)</span
                  >
                  <input
                    class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-gray-100 focus:outline-none focus:shadow-md dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                    placeholder="Alamat Penagihan Kredit/Pembayaran"
                    @click="if (!$parent.isObjEmpty(tempDataCustomer)) { closeBillingAddressIS = false; } else { closeBillingAddressIS = true; }"
                    @click.away="closeBillingAddressIS = true;"
                    @keydown.tab="closeBillingAddressIS = true;"
                    x-show="$parent.isObjEmpty(tempDataBillingAddress)"
                    :class="{'border-red-600 focus:border-red-400 focus:outline-none focus:shadow-outline-red': errBillingAddress }"
                  />
                </label>
                <div class="w-full">
                  <div
                    class="relative bg-green-300 bg-opacity-50 mt-1 text-sm inline-block py-1 pl-4 pr-8"
                    x-show="!$parent.isObjEmpty(tempDataBillingAddress)"
                  >
                    <i x-text="tempDataBillingAddress.One+', '"></i>
                    <i
                      x-show="tempDataBillingAddress.Two != ''"
                      x-text="tempDataBillingAddress.Two+', '"
                    ></i>
                    <i
                      x-text="tempDataBillingAddress.Village+', '+tempDataBillingAddress.District+', '+tempDataBillingAddress.City+', '+tempDataBillingAddress.Province"
                    ></i>
                    <i
                      x-show="tempDataBillingAddress.Zip != ''"
                      x-text="', '+tempDataBillingAddress.Zip"
                    ></i>
                    <p
                      style="margin-top: 0.42rem"
                      class="cursor-pointer absolute right-0 top-0 mr-2"
                      @click="tempDataBillingAddress = {};
                    formData.billing_address = 0;"
                    >
                      {{ template "_svg_icon_close" }}
                    </p>
                  </div>
                </div>
                <ul
                  x-transition:leave="transition ease-in duration-150"
                  x-transition:leave-start="opacity-100"
                  x-transition:leave-end="opacity-0"
                  x-show="!closeBillingAddressIS"
                  class="absolute z-30 left-0 right-0 -mt-1 md:mr-1 md:ml-1 text-gray-600 bg-white border-none border-r border-l border-b border-gray-100 rounded-br-md rounded-bl-md shadow-md dark:border-gray-700 dark:text-gray-300 dark:bg-gray-700"
                  aria-label="submenu"
                >
                  <div
                    x-show="addresses.length > 0 && closeBillingAddressIS == false && $parent.isObjEmpty(tempDataBillingAddress)"
                  >
                    <template
                      x-for="(address, index) in addresses"
                      :key="index"
                    >
                      <li class="flex">
                        <a
                          class="inline-flex items-center w-full px-3 py-1 text-sm transition-colors duration-150 hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                          href="#"
                          tabindex="-1"
                          @click="tempDataBillingAddress = 
                        {
                          ID: address.ID,
                          One: address.One,
                          Two: address.Two,
                          Zip: address.Zip,
                          Village: address.VillageName,
                          District: address.DistrictName,
                          City: address.CityName,
                          Province: address.ProvinceName,
                        };
                        formData.billing_address = address.ID;"
                        >
                          <span x-text="address.Name"></span>
                          &nbsp;<i
                            x-text="'( '+address.Description+' )'"
                            class="text-xs text-gray-500"
                            x-show="address.Description != ''"
                          ></i>
                        </a>
                      </li>
                    </template>
                  </div>
                  <div x-show="addresses.length == 0">
                    <span
                      class="inline-flex items-center w-full px-3 py-1 text-sm transition-colors duration-150 hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                      >Tidak ada data</span
                    >
                  </div>
                </ul>
              </div>
            </div>

            <template x-if="formData.credit">
              <!-- Pilih arah tagih -->
              <div class="w-full flex flex-wrap md:px-1">
                <label
                  class="block mt-4 text-sm"
                  title="Jika alamat penagihan tidak ditetapkan maka alamat penagihan sama dengan alamat pengiriman"
                >
                  <span class="text-gray-700 dark:text-gray-400"
                    >Arah Tagih</span
                  >
                </label>
                <!-- Zona -->
                <div class="w-full flex flex-wrap">
                  <template x-if="zones.length > 0">
                    <template x-for="zone in zones" :key="zone.ID">
                      <div
                        class="w-full md:w-1/3 p-1 cursor-pointer rounded-sm hover:bg-green-50"
                        @click="if (activeZone !== zone.ID) { activeZone = zone.ID; lines = zone.List; } else { activeZone = null; lines = []; }"
                      >
                        <div
                          class="flex items-center p-4 bg-white rounded-lg shadow-xs hover:bg-gray-50 dark:bg-gray-800"
                        >
                          <div
                            class="p-3 mr-4 rounded-full"
                            :class="{'text-orange-500 bg-orange-100': activeZone == zone.ID, 'text-blue-500 bg-blue-100': activeZone !== zone.ID }"
                          >
                            {{ template "_svg_icon_globe" }}
                          </div>
                          <div>
                            <p
                              class="text-lg font-semibold text-gray-700 dark:text-gray-200"
                              x-text="`#${zone.Name}`"
                            ></p>
                            <p
                              class="text-xs text-gray-700 dark:text-gray-200"
                              x-text="zone.Collector.Name"
                            ></p>
                          </div>
                        </div>
                      </div>
                    </template>
                  </template>
                </div>
                <!-- Arah -->
                <template x-if="lines !== null">
                  <div
                    class="w-full overflow-x-auto flex flex-wrap p-2 mt-2 text-sm font-medium text-gray-500 rounded-md shadow-inner bg-blue-50 dark:text-gray-400 dark:bg-gray-900"
                  >
                    <template x-for="line in lines" :key="line.ID">
                      <div
                        class="w-1/3 py-1 px-2 cursor-pointer hover:bg-blue-200 hover:text-blue-500"
                        :class="{'text-blue-500': formData.line == line.ZoneLineID }"
                        x-text="`#${line.ZoneLineCode} - ${line.ZoneLineName}`"
                        @click="if (formData.line !== line.ZoneLineID) { formData.line = line.ZoneLineID; } else { formData.line = null; }"
                      ></div>
                    </template>
                  </div>
                </template>
                <span
                  class="text-xs text-red-600 dark:text-red-400"
                  x-text="errmLine"
                  :class="{'invisible': errLine == false}"
                ></span>
              </div>
            </template>
          </div>

          <!-- List Item/Produk -->
          <div
            class="w-full md:w-1/3 md:px-1"
            x-show="selectedProducts.length > 0"
          >
            <label class="block mt-4 text-sm">
              <span class="text-gray-700 dark:text-gray-400">Daftar Item</span>
            </label>
            <div class="w-full mt-1">
              <template
                x-for="(product, index) in selectedProducts"
                :key="index"
              >
                <div class="flex overflow-hidden border-b mt-1 pb-1 relative">
                  <!-- Tombol discard item -->
                  <div
                    class="cursor-pointer absolute bg-red-200 text-red-500 font-bold text-xs top-0 right-0 mt-1 mr-1"
                    @click="removeSelectedProduct(index)"
                    title="Hapus"
                  >
                    <p>{{ template "_svg_icon_close" }}</p>
                  </div>
                  <!-- Gambar/thumbnail produk -->
                  <div class="w-1/4 bg-cover p-1">
                    <img
                      class="object-cover w-16 h-16 border"
                      :src="'/file/product/thumbnail/'+product.Thumbnail"
                      alt=""
                      loading="lazy"
                      x-show="product.Thumbnail != ''"
                    />
                    <img
                      class="object-cover w-16 h-16 border"
                      :src="'/file/product/thumbnail/no-photo.png'"
                      alt=""
                      loading="lazy"
                      x-show="product.Thumbnail === ''"
                    />
                  </div>
                  <!-- Deskripsi/detail produk -->
                  <div class="p-1 w-3/4">
                    <h1
                      class="text-gray-500 font-bold"
                      x-text="product.Name"
                    ></h1>
                    <p class="text-gray-500 text-sm">
                      <span
                        x-text="product.Brand"
                        class="inline-block bg-orange-500 rounded-full px-3 py-1 text-xs font-semibold text-orange-100 mr-2"
                      ></span
                      >&nbsp;<i x-text="product.Category" class="text-xs"></i>
                    </p>

                    <!-- Harga barang kredit -->
                    <div
                      x-show="formData.credit == true"
                      class="flex item-center mt-2"
                    >
                      <span
                        class="inline-block rounded-full px-3 py-1 text-xs font-semibold mr-2"
                        :class="{'bg-red-200 text-red-500 line-through': selectedProducts[index].creditDiscountPrice > 0, 'bg-yellow-200 text-yellow-500': selectedProducts[index].creditDiscountPrice == 0 }"
                        x-text="'Harga kredit ' + toRupiah(creditPrice(index, true) * formData.duration)"
                      ></span>
                    </div>
                    <!-- Harga barang kredit diskon -->
                    <div
                      x-show="formData.credit == true && selectedProducts[index].creditDiscountPrice > 0"
                      class="w-full item-center mt-2"
                    >
                      <span
                        class="inline-block bg-green-200 rounded-full px-3 py-1 text-xs font-semibold text-green-500 mr-2"
                        x-text="'Harga diskon ' + toRupiah(selectedProducts[index].creditDiscountPrice * formData.duration)"
                      ></span>
                    </div>
                    <!-- Harga barang cash -->
                    <p
                      x-show="selectedProducts[index].discountPrice > 0 && formData.credit == false"
                      class="text-sm mt-2"
                    >
                      <span
                        class="inline-block bg-red-200 rounded-full px-3 py-1 text-xs font-semibold text-red-500 line-through"
                        x-text="'Harga ' + toRupiah(price(index,true)/formData.order_items[index].quantity)"
                      ></span>
                      <i
                        class="text-xs text-green-400 pl-1 font-bold"
                        x-text="'(' + (((price(index,true)-price(index))/price(index,true))*100).toFixed(2) + '%)'"
                      ></i>
                    </p>
                    <p class="mt-2 text-gray-600">
                      <textarea
                        class="block w-full text-sm dark:text-gray-300 dark:border-gray-600 dark:bg-gray-700 form-textarea focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:focus:shadow-outline-gray"
                        rows="1"
                        placeholder="Catatan mengenai barang!"
                        x-model="formData.order_items[index].notes"
                      ></textarea>
                    </p>

                    <div
                      x-show="formData.credit == true"
                      class="flex flex-wrap w-full item-center mt-2"
                    >
                      <div
                        x-show="selectedProducts[index].creditDiscountPrice > 0"
                        class="w-full"
                      >
                        <i
                          class="text-sm text-red-400 line-through"
                          x-text="toRupiah(creditPrice(index, true)/formData.order_items[index].quantity) + '/bulan'"
                        ></i>
                        <i
                          class="text-sm text-green-400 pl-1 font-bold"
                          x-text="'(' + (((creditPrice(index,true)-creditPrice(index))/creditPrice(index,true))*100).toFixed(2) + '%)'"
                        ></i>
                      </div>
                    </div>
                    <div class="flex item-center justify-between mt-3">
                      <h1
                        class="text-gray-700 font-semibold text-lg"
                        x-text="toRupiah(price(index))"
                        x-show="formData.credit == false && editPrice != index"
                        @dblclick="toggleEditPrice(index)"
                      ></h1>
                      <h1
                        class="text-gray-700 font-semibold text-lg"
                        x-text="toRupiah(creditPrice(index))"
                        x-show="formData.credit == true && editPrice != index"
                        @dblclick="toggleEditPrice(index)"
                      ></h1>
                      <input
                        class="w-32 appearance-none outline-none"
                        x-model="selectedProducts[index].discountPrice"
                        x-show="formData.credit == false && editPrice == index"
                        @click.away="toggleEditPrice(index)"
                        @keydown.enter="toggleEditPrice(index)"
                        @keydown.escape="toggleEditPrice(index)"
                        :id="`input-price-${index}`"
                      />
                      <input
                        class="w-32 appearance-none outline-none"
                        x-model="selectedProducts[index].creditDiscountPrice"
                        x-show="formData.credit == true && editPrice == index"
                        @click.away="toggleEditPrice(index)"
                        @keydown.enter="toggleEditPrice(index)"
                        @keydown.escape="toggleEditPrice(index)"
                        :id="`input-credit-price-${index}`"
                      />
                      <input
                        type="number"
                        class="w-12 px-1 border rounded"
                        x-model.number="formData.order_items[index].quantity"
                        min="1"
                      />
                    </div>
                  </div>
                </div>
              </template>
            </div>
            <div class="w-full flex">
              <div class="w-1/4 px-1"><span>Diskon</span></div>
              <div
                class="w-3/4 px-1 flex flex-wrap items-center"
                :class="{'text-red-500': total_ori < countTotal() }"
                class="text-sm"
              >
                <span x-show="total_ori < countTotal()" class="text-sm">-</span>
                <!-- Diskon pembelian cash -->
                <span
                  x-show="formData.credit == false"
                  class="text-sm"
                  x-text="toRupiah(total_ori-countTotal())"
                ></span>
                <!-- Diskon pembelian kredit -->
                <span
                  x-show="formData.credit == true"
                  x-text="toRupiah((total_ori-countTotal())*formData.duration)"
                  class="pr-1"
                ></span>
                <div
                  class="text-gray-500 text-xs"
                  x-show="formData.credit == true"
                >
                  (
                  <span x-show="total_ori < countTotal()" class="text-sm"
                    >-</span
                  >
                  <span x-text="toRupiah(total_ori-countTotal())"></span>
                  /bulan)
                </div>
              </div>
            </div>
            <div class="w-full flex mt-1">
              <div class="w-1/4 px-1">
                <span x-show="formData.credit == false">Total</span>
                <span x-show="formData.credit == true">Cicilan</span>
              </div>
              <div class="w-3/4 px-1">
                <span
                  class="text-gray-700 font-semi text-xl"
                  x-text="toRupiah(countTotal())"
                ></span>
                <span
                  class="text-sm text-gray-500"
                  x-show="formData.credit == true"
                  >/ bulan</span
                >
              </div>
            </div>
            <div class="w-full flex mt-1" x-show="formData.credit == true">
              <div class="w-1/4 px-1">
                <span>Total</span>
              </div>
              <div class="w-3/4 px-1">
                <span
                  class="text-gray-700 font-semi text-xl"
                  x-text="toRupiah(countTotal()*formData.duration)"
                ></span>
              </div>
            </div>
          </div>
        </div>

        <button
          type="submit"
          class="block w-full px-4 py-2 mt-4 text-sm font-medium leading-5 text-center text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-lg active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple"
          @click="submitData($dispatch)"
          :disabled="loading == true"
          x-text="loadingText"
          :class="{'cursor-not-allowed opacity-50': loading == true }"
        ></button>
      </div>

      <!-- Order berhasil dibuat -->
      {{ template "dashboard_orders_add_order_created" .}}
    </div>
  </div>

  <script>
    function create() {
      return {
        formData: {
          customer: 0,
          sales: null,
          surveyor: null,
          collector: null,
          credit: true,
          credit_mask: "",
          duration: 12,
          due: null,
          line: null,
          notes: "",
          order_date: null,
          shipping_date: null,
          billing_address: null,
          shipping_address: null,
          deposit: null,
          order_items: [],
          substitutes: [],
        },
        instantData: {
          customer: "",
          sales: "",
          surveyor: "",
          collector: "",
          billing_address: "",
          shipping_address: "",
        },
        orderCreated: false,
        tempDataCustomer: {},
        tempDataSales: {},
        tempDataSurveyor: {},
        tempDataCollector: {},
        tempDataShippingAddress: {},
        tempDataBillingAddress: {},
        closeCustomerIS: true,
        closeSalesIS: true,
        closeSurveyorIS: true,
        closeCollectorIS: true,
        closeShippingAddressIS: true,
        closeBillingAddressIS: true,
        customerIS: [],
        salesIS: [],
        surveyorIS: [],
        collectorIS: [],
        addresses: [],
        loadingText: "Buat Order",
        loading: false,
        duration: null,
        total_ori: 0,
        products: [],
        selectedProducts: [],
        editPrice: null,
        zones: [],
        activeZone: null,
        lines: null,
        notifStatus: "",
        errCustomer: false,
        errmCustomer: "",
        errSales: false,
        errmSales: "",
        errSurveyor: false,
        errmSurveyor: "",
        errCollector: false,
        errmCollector: "",
        errDuration: false,
        errmDuration: "",
        errDue: false,
        errmDue: "",
        errLine: false,
        errmLine: "",
        errOrderDate: false,
        errmOrderDate: "",
        errShippingDate: false,
        errmShippingDate: "",
        errShippingAddress: false,
        errmShippingAddress: "",
        errBillingAddress: false,
        errmBillingAddress: "",
        errDeposit: false,
        errmDeposit: "",
        errOrderItems: false,
        errmOrderItems: "",
        init($dispatch) {
          this.fetchZones($dispatch);
        },
        fetchZones($dispatch) {
          fetch(`/api/v1/local/zone/list`, {
            method: "GET",
          })
            .then((res) => res.json())
            .then((data) => {
              if (data.status == "error") {
                $dispatch("notif", {
                  type: data.status,
                  message: data.message,
                });
              }
              if (data.zones !== null) {
                this.zones = data.zones;
              } else {
                this.zones = [];
              }
            })
            .catch(() => {
              console.log("Telah terjadi kesalahan saat memuat data produk");
            });
        },
        submitData($dispatch) {
          this.loadingText = "Loading...";
          this.loading = true;

          // Jika bukan kredit
          if (this.formData.credit == false) {
            this.formData.duration = null;
            this.formData.credit_mask = "cash";
          } else {
            this.formData.credit_mask = "credit";
          }

          fetch("/api/v1/local/order/create", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(this.formData),
          })
            .then((res) => res.json())
            .then((data) => {
              this.loadingText = "Buat Order";
              this.loading = false;

              if (data.status == "error") {
                this.notifStatus = "error";
              }
              if (data.status == "warning") {
                this.notifStatus = "warning";
              }
              if (data.status == "success") {
                this.notifStatus = "success";
                this.orderCreated = true;
                this.order = data.order;
                console.log(data.order);
              }

              if (data.customer) {
                this.errCustomer = true;
                this.errmCustomer = data.customer;
              } else {
                this.errCustomer = false;
                this.errmCustomer = "";
              }

              if (data.due) {
                this.errDue = true;
                this.errmDue = data.due;
              } else {
                this.errDue = false;
                this.errmDue = "";
              }

              if (data.line) {
                this.errLine = true;
                this.errmLine = data.line;
              } else {
                this.errLine = false;
                this.errmLine = "";
              }

              if (data.orderdate) {
                this.errOrderDate = true;
                this.errmOrderDate = data.orderdate;
              } else {
                this.errOrderDate = false;
                this.errmOrderDate = "";
              }

              if (data.shippingdate) {
                this.errShippingDate = true;
                this.errmShippingDate = data.shippingdate;
              } else {
                this.errShippingDate = false;
                this.errmShippingDate = "";
              }

              if (data.shippingaddress) {
                this.errShippingAddress = true;
                this.errmShippingAddress = data.shippingaddress;
              } else {
                this.errShippingAddress = false;
                this.errmShippingAddress = "";
              }

              if (data.deposit) {
                this.errDeposit = true;
                this.errmDeposit = data.deposit;
              } else {
                this.errDeposit = false;
                this.errmDeposit = "";
              }

              if (data.orderitems) {
                this.errOrderItems = true;
                this.errmOrderItems = data.orderitems;
              } else {
                this.errOrderItems = false;
                this.errmOrderItems = "";
              }

              if (data.message) {
                message = data.message.split(":");
                if (message.length > 1) {
                  minfo = message[1].split("-");
                  pid = minfo[0];
                  stock = minfo[1];
                  this.selectedProducts.map((product) => {
                    if (product.ID == pid) {
                      $dispatch("notif", {
                        type: this.notifStatus,
                        message: `${product.Name} Stoknya tinggal ${stock}`,
                      });
                    }
                  });
                  return;
                }
                $dispatch("notif", {
                  type: this.notifStatus,
                  message: data.message,
                });
              }
            })
            .catch((error) => {
              this.loading = false;
              console.log("Telah terjadi kesalahan " + error);
            });
        },
        searchNIK() {
          fetch(
            `/api/v1/local/user/search/ric/10?search=${this.instantData.customer}`,
            {
              method: "GET",
              headers: { "Content-Type": "application/json" },
            }
          )
            .then((res) => res.json())
            .then((data) => {
              if (data.error) {
                $dispatch("notif", {
                  type: "error",
                  message: data.error,
                });
              }
              if (data.users) {
                this.customerIS = data.users;
              } else {
                this.customerIS = [];
              }
            })
            .catch(() => {
              this.loading = false;
              console.log("Telah terjadi kesalahan saat memuat data customer");
            });
        },
        searchSales() {
          fetch(
            `/api/v1/local/user/search/sales/10?search=${this.instantData.sales}`,
            {
              method: "GET",
              headers: { "Content-Type": "application/json" },
            }
          )
            .then((res) => res.json())
            .then((data) => {
              if (data.error) {
                $dispatch("notif", {
                  type: "error",
                  message: data.error,
                });
              }
              if (data.users) {
                this.salesIS = data.users;
              } else {
                this.salesIS = [];
              }
            })
            .catch(() => {
              this.loading = false;
              console.log("Telah terjadi kesalahan saat memuat data sales");
            });
        },
        searchSurveyor() {
          fetch(
            `/api/v1/local/user/search/surveyor/10?search=${this.instantData.surveyor}`,
            {
              method: "GET",
              headers: { "Content-Type": "application/json" },
            }
          )
            .then((res) => res.json())
            .then((data) => {
              if (data.error) {
                $dispatch("notif", {
                  type: "error",
                  message: data.error,
                });
              }
              if (data.users) {
                this.surveyorIS = data.users;
              } else {
                this.surveyorIS = [];
              }
            })
            .catch(() => {
              this.loading = false;
              console.log("Telah terjadi kesalahan saat memuat data surveyor");
            });
        },
        searchCollector() {
          fetch(
            `/api/v1/local/user/search/collector/10?search=${this.instantData.collector}`,
            {
              method: "GET",
              headers: { "Content-Type": "application/json" },
            }
          )
            .then((res) => res.json())
            .then((data) => {
              if (data.error) {
                $dispatch("notif", {
                  type: "error",
                  message: data.error,
                });
              }
              if (data.users) {
                this.collectorIS = data.users;
              } else {
                this.collectorIS = [];
              }
            })
            .catch(() => {
              this.loading = false;
              console.log("Telah terjadi kesalahan saat memuat data collector");
            });
        },
        removeSelectedProduct(pid) {
          this.selectedProducts.splice(pid, 1);
          this.formData.order_items.splice(pid, 1);
        },
        price(index, ori = false) {
          var num = 0;

          num = Number(
            this.selectedProducts[index].Price *
              this.formData.order_items[index].quantity
          );

          if (ori) {
            return num;
          }

          if (this.selectedProducts[index].discountPrice != 0) {
            num =
              this.selectedProducts[index].discountPrice.replace(
                /[^0-9]+/g,
                ""
              ) * this.formData.order_items[index].quantity;
          }

          return num;
        },
        creditPrice(index, ori = false) {
          var price = 0;
          var item = this.selectedProducts[index];

          if (item.CreditPrice != null) {
            for (cpi = 0; cpi < item.CreditPrice.length; cpi++) {
              if (this.formData.duration == item.CreditPrice[cpi].Duration) {
                price = item.CreditPrice[cpi].Price;
              }
            }
          }

          price = Number(price * this.formData.order_items[index].quantity);

          if (ori) {
            return price;
          }

          if (this.selectedProducts[index].creditDiscountPrice != 0) {
            price =
              this.selectedProducts[index].creditDiscountPrice.replace(
                /[^0-9]+/g,
                ""
              ) * this.formData.order_items[index].quantity;
          }

          return price;
        },
        countTotal() {
          var total = 0;
          var total_ori = 0;
          var products = this.selectedProducts;
          if (this.formData.credit == false) {
            for (i = 0; i < products.length; i++) {
              total += this.price(i);
              total_ori += this.price(i, true);
            }
          }
          if (this.formData.credit == true) {
            for (i = 0; i < products.length; i++) {
              total += this.creditPrice(i);
              total_ori += this.creditPrice(i, true);
            }
          }

          this.total_ori = total_ori;

          return total;
        },
        toggleEditPrice(index) {
          if (this.editPrice == index) {
            this.editPrice = null;
          } else {
            this.editPrice = index;

            this.$nextTick(() => {
              if (this.formData.credit == false) {
                document.getElementById(`input-price-${index}`).select();
              } else {
                document.getElementById(`input-credit-price-${index}`).select();
              }
            });
          }

          if (this.formData.credit == false) {
            this.formData.order_items[index].discount = Number(
              this.selectedProducts[index].discountPrice
            );
          } else {
            this.formData.order_items[index].discount = Number(
              this.selectedProducts[index].creditDiscountPrice
            );
          }
        },
        removeSubstitute(id) {
          this.formData.substitutes.splice(id, 1);
        },
      };
    }
  </script>
</div>
{{ end }}
